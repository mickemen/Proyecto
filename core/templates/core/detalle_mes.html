{% extends 'base.html' %}

{% block title %}Detalle {{ anio_mes }}{% endblock %}

{% block content %}
<h1 class="mb-3">Detalle del mes {{ anio_mes }}</h1>

<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="card text-bg-light">
      <div class="card-body">
        <h5 class="card-title mb-3">Resumen (vista)</h5>
        <p class="mb-1"><strong>Ingresos:</strong> {{ resumen.ingresos }}</p>
        <p class="mb-1"><strong>Gastos:</strong> {{ resumen.gastos }}</p>
        <p class="mb-0"><strong>Balance:</strong> {{ resumen.balance }}</p>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card text-bg-light">
      <div class="card-body">
        <h5 class="card-title mb-3">Calculado por transacciones</h5>
        <p class="mb-1"><strong>Ingresos:</strong> {{ total_ingresos_calc }}</p>
        <p class="mb-0"><strong>Gastos:</strong> {{ total_gastos_calc }}</p>
      </div>
    </div>
  </div>
</div>

<h2 class="h4 mt-4">Gasto por categoría</h2>
<div class="table-responsive mb-4">
  <table class="table table-striped table-hover align-middle">
    <thead>
      <tr>
        <th>Categoría</th>
        <th>Gasto total</th>
      </tr>
    </thead>
    <tbody>
    {% for g in gastos_categoria %}
      <tr>
        <td>{{ g.categoria }}</td>
        <td>{{ g.gasto_total }}</td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="2" class="text-center text-muted">Sin gastos en este mes.</td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<h2 class="h4 mt-4">Transacciones</h2>
<div class="table-responsive">
  <table class="table table-striped table-hover align-middle">
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Cuenta</th>
        <th>Categoría</th>
        <th>Descripción</th>
        <th>Monto</th>
      </tr>
    </thead>
    <tbody>
    {% for t in transacciones %}
      <tr>
        <td>{{ t.fecha }}</td>
        <td>{{ t.cuenta.nombre }}</td>
        <td>{{ t.categoria.nombre }}</td>
        <td>{{ t.descripcion }}</td>
        <td>{{ t.monto }}</td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="5" class="text-center text-muted">
          No hay transacciones para este mes.
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<a class="btn btn-outline-secondary mt-3" href="{% url 'core:inicio' %}">
  ← Volver al resumen
</a>
{% endblock %}
